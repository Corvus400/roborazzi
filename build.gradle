import com.vanniktech.maven.publish.SonatypeHost

plugins {
  id 'com.android.application' version '7.3.1' apply false
  id 'com.android.library' version '7.3.1' apply false
  id 'org.jetbrains.kotlin.android' version '1.7.20' apply false
  id "com.vanniktech.maven.publish" version "0.24.0" apply false
}

allprojects {
  if (project.path.startsWith(":roborazzi")) {
    apply plugin: 'com.vanniktech.maven.publish'
    project.group = "io.github.takahirom"
    project.version = "0.1.0"
    mavenPublishing {
      publishToMavenCentral(SonatypeHost.S01)
      signAllPublications()
    }

    plugins.withId('maven-publish') {
      publishing {
        repositories {
          maven {
            name = "LocalMaven"
            url = file("${rootProject.buildDir}/localMaven").toURI().toString()
          }
          def internalUrl = providers.gradleProperty("internalUrl")
          if (internalUrl.isPresent()) {
            maven {
              name = "internal"
              url = internalUrl
              credentials {
                username = providers.gradleProperty("internalUsername").get()
                password = providers.gradleProperty("internalPassword").get()
              }
            }
          }
        }
      }
    }

    plugins.withId('signing') {
      signing {
        def signingKey = findProperty('signingKey')
        def signingPassword = ''
        useInMemoryPgpKeys(signingKey, signingPassword)
      }
    }
  }
}